# SQL CRUD

## The SQL code to create each of the required tables

### Create _restaurants_ table
``` sql
CREATE TABLE restaurants (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    category TEXT NOT NULL,
    price_tier TEXT NOT NULL,
    neighborhood TEXT NOT NULL,
    opening_hours TEXT NOT NULL,
    closing_hours TEXT NOT NULL,
    average_rating REAL NOT NULL,
    good_for_kids BOOLEAN NOT NULL
);
```

### Create _reviews_ table
``` sql
CREATE TABLE reviews (
    id INTEGER PRIMARY KEY,
    restaurant_id INTEGER NOT NULL,
    review_text TEXT NOT NULL,
    rating INTEGER NOT NULL,
    review_date TEXT NOT NULL,
    FOREIGN KEY (restaurant_id) REFERENCES restaurants(id)
);
```

### Create _users_ table
``` sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY,
    email TEXT NOT NULL UNIQUE,
    password TEXT NOT NULL,
    handle TEXT NOT NULL UNIQUE
);
```
### Create _posts_ table
``` sql
CREATE TABLE posts (
    id INTEGER PRIMARY KEY,
    user_id INTEGER NOT NULL,
    content TEXT NOT NULL,
    post_date TEXT NOT NULL,
    post_type TEXT NOT NULL CHECK(post_type IN ('Message', 'Story')),
    visible BOOLEAN NOT NULL DEFAULT TRUE,
    recipient_id INTEGER,
    viewed BOOLEAN,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (recipient_id) REFERENCES users(id)
);
```
I include a "viewed" column which stores null for stories and true/false (randomly generated by Mockaroo) for messages. By checking if it is true/false I set true/false for 'visible' column. 

``` sql
UPDATE posts SET visible = 'FALSE' WHERE post_type = 'Message' AND viewed = 'TRUE';
```

## Links to each of the practice CSV data files
- [restaurants.csv](data/restaurants.csv)
- [users.csv](data/users.csv)
- [posts.csv](data/posts.csv)

## The SQLite code to import the practice CSV data files into the tables.
```sql
.mode csv
.headers on
.import restaurants.csv restaurants --skip 1
.import users.csv users --skip 1
.import posts.csv posts --skip 1
```

## The SQL queries that solve each of the tasks

### Part 1: Restaurant finder
1. Find all cheap restaurants in a particular neighborhood (pick any neighborhood as an example).
    ``` sql
    SELECT * FROM restaurants WHERE price_tier = 'cheap' AND neighborhood = 'Lower East Side';
    ```

2. Find all restaurants in a particular genre with 3 stars or more, ordered by the number of stars in descending order.
    ``` sql
    SELECT * FROM restaurants WHERE category = 'Italian' AND average_rating >= 3 ORDER BY average_rating DESC;
    ```

3. Find all restaurants that are open now (assuming now is '15:00' for example):
    ``` sql
    SELECT * FROM restaurants WHERE opening_hours <= '15:00' AND closing_hours > '15:00';
    ```

4. Leave a review for a restaurant
    ``` sql
    INSERT INTO reviews (restaurant_id, review_text, rating, review_date) VALUES (100, 'Great place with lovely ambiance!', 5, '2024-02-24');
    ```

5. Delete all restaurants that are not good for kids.
    ``` sql
    DELETE FROM restaurants WHERE good_for_kids = 'false';
    ```

6. Find the number of restaurants in each NYC neighborhood.
    ``` sql
    SELECT neighborhood, COUNT(*) AS number_of_restaurants FROM restaurants GROUP BY neighborhood;
    ```

### Part 2: Social media app
1. Register a new User.
    ``` sql
    INSERT INTO users (email, password, handle) VALUES ('sh6382@nyu.edu', '123nyu321', 'Liovai');
    ```

2. Create a new Message sent by a particular User to a particular User (pick any two Users for example).
    ``` sql
    INSERT INTO posts (user_id, content, post_date, post_type, visible, recipient_id, viewed) VALUES (1, 'Helloworld!', '2024-02-24 14:00:00', 'Message', 'TRUE', 2, 'FALSE');
    ```

3. Create a new Story by a particular User (pick any User for example).
    ``` sql
    INSERT INTO posts (user_id, content, post_date, post_type, visible) VALUES (1, 'Sunday is good.', '2024-02-24 15:00:00', 'Story', 'TRUE');
    ```

4. Show the 10 most recent visible Messages and Stories, in order of recency.
    ``` sql
    SELECT * FROM posts WHERE visible = 'TRUE' ORDER BY post_date DESC LIMIT 10;
    ```

5. Show the 10 most recent visible Messages sent by a particular User to a particular User (pick any two Users for example), in order of recency.
    ``` sql
    SELECT * FROM posts WHERE user_id = 1 AND recipient_id = 2 AND post_type = 'Message' AND visible = 'TRUE' ORDER BY post_date DESC LIMIT 10;
    ```

6. Make all Stories that are more than 24 hours old invisible.
    ``` sql
    UPDATE posts SET visible = 'FALSE' WHERE post_type = 'Story' AND (JULIANDAY('now') - JULIANDAY(post_date)) * 24 > 24;
    ```

7. Show all invisible Messages and Stories, in order of recency.
    ``` sql
    SELECT * FROM posts WHERE visible = 'FALSE' ORDER BY post_date DESC;
    ```

8. Show the number of posts by each User.
    ``` sql
    SELECT user_id, COUNT(*) AS total_posts FROM posts GROUP BY user_id;
    ```

9. Show the post text and email address of all posts and the User who made them within the last 24 hours.
    ``` sql
    SELECT p.content, u.email FROM posts p JOIN users u ON p.user_id = u.id WHERE (JULIANDAY('now') - JULIANDAY(post_date)) * 24 <= 24;
    ```

10. Show the email addresses of all Users who have not posted anything yet.
    ``` sql
    SELECT email FROM users WHERE id NOT IN (SELECT DISTINCT user_id FROM posts);
    ```